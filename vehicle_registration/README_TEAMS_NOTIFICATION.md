# 📱 Microsoft Teams Notification System สำหรับการซ่อมบำรุงรถ

## 📋 ฟีเจอร์หลัก

ระบบนี้สามารถส่งแจ้งเตือนการซ่อมบำรุงรถไปยัง Microsoft Teams Channel โดยอัตโนมัติ ด้วยฟีเจอร์ดังนี้:

### ✅ ฟีเจอร์พื้นฐาน
- 📤 ส่งแจ้งเตือนไปยัง Microsoft Teams พร้อม Adaptive Card
- 📅 ตั้งค่าวันที่เริ่มต้นและสิ้นสุดการแจ้งเตือน
- 🔄 กำหนดช่วงเวลาการแจ้งเตือนซ้ำ (เช่น ทุก 30 วัน)
- 📊 ติดตามประวัติการส่งแจ้งเตือน
- ⏰ Scheduled Action (CRON) ส่งแจ้งเตือนอัตโนมัติทุกวัน

### 📋 ข้อมูลที่ส่ง
แจ้งเตือนจะส่งข้อมูลต่อไปนี้:
- 🚗 ข้อมูลรถ: ชื่อรถ, ทะเบียนรถ
- 🔧 ข้อมูลการซ่อม: หมวดหมู่, รายการซ่อม, ช่างผู้ซ่อม
- 🏢 ผู้ให้บริการ: ศูนย์บริการ หรือ ช่างภายใน
- 📅 วันเวลา: วันเริ่มซ่อม, วันซ่อมเสร็จ
- 💰 ค่าใช้จ่าย: ค่าใช้จ่ายทั้งหมด
- 📝 หมายเหตุ: รายละเอียดเพิ่มเติม

---

## 🚀 วิธีการติดตั้ง

### 1️⃣ ติดตั้ง Module
```bash
# ไฟล์อยู่ที่: C:\Program Files\Odoo 18.0.20251009\server\custom-addons\vehicle_registration

# ใน Odoo ให้ทำการ Update Module List
Activate Developer Mode → Apps → Update Apps List
```

### 2️⃣ ติดตั้งและเปิดใช้งาน Module
```
ค้นหา: vehicle_registration
ให้กดปุ่ม Install
```

---

## 📱 การตั้งค่า Microsoft Teams Webhook

### Step 1: สร้าง Incoming Webhook ใน Teams Channel

1. เข้าไปที่ Microsoft Teams Channel ที่ต้องการรับแจ้งเตือน
2. คลิก **...** (More options) → **Connectors** → **Configure**
3. ค้นหา **Incoming Webhook** → **Configure**
4. ตั้งชื่อ Webhook: `🚗 Vehicle Maintenance Alerts`
5. (ถ้าต้องการ) อัปโหลดรูปภาพ
6. คลิก **Create**
7. **คัดลอก URL** ที่ได้

### Step 2: ใส่ Webhook URL ลงในระบบ Odoo

#### วิธีที่ 1: ผ่านการตั้งค่า System Parameters
```
Settings → Technical → System Parameters
ค้นหา: vehicle.teams_webhook_url
ใส่ URL ลงในช่อง Value
```

#### วิธีที่ 2: ใส่เมื่อสร้างการแจ้งเตือน
```
ระบบการซ่อมบำรุง → Microsoft Teams Notification
เปิดฟอร์มการแจ้งเตือน
ใส่ Webhook URL ในช่อง "Microsoft Teams Webhook URL"
```

---

## 🎯 วิธีการใช้งาน

### 🔧 สร้างการแจ้งเตือนสำหรับการซ่อมบำรุง

#### วิธีที่ 1: ผ่าน Server Actions
1. ไปที่: **ระบบการซ่อมบำรุง → ประวัติการซ่อม**
2. เลือกรายการการซ่อมที่ต้องการ
3. คลิก **Action** (กระดุมมีรูปไข่หรือหนังสือ) ด้านบนซ้าย
4. เลือก: **✅ เปิดการแจ้งเตือน Microsoft Teams**

#### วิธีที่ 2: ผ่าน Menu ตรง
1. ไปที่: **ระบบการซ่อมบำรุง → Microsoft Teams Notification**
2. คลิก **Create**
3. กรอกข้อมูล:
   - **การซ่อม**: เลือกการซ่อมที่ต้องการ
   - **Microsoft Teams Webhook URL**: ใส่ Webhook URL
   - **เปิดการแจ้งเตือน**: เปิด (Toggle)
   - **วันที่เริ่มแจ้งเตือน**: วันปัจจุบัน (Default)
   - **แจ้งเตือนทุก (วัน)**: 30 วัน (Default)
4. คลิก **Save**
5. คลิก **🚀 ส่งแจ้งเตือนตอนนี้** (ถ้าต้องการส่งทันที)

### 📊 การติดตามการส่งแจ้งเตือน
```
ระบบการซ่อมบำรุง → Microsoft Teams Notification
ดูได้จาก:
- ส่งแจ้งเตือนครั้งสุดท้าย: Timestamp
- จำนวนครั้งที่ส่ง: จำนวนเต็ม
- วันสิ้นสุดการแจ้งเตือน: Date
```

---

## ⚙️ Configuration Fields

| ฟิลด์ | ประเภท | ค่าเริ่มต้น | คำอธิบาย |
|------|-------|---------|---------|
| **การซ่อม** | Many2one | - | เลือกการซ่อมที่ต้องการแจ้งเตือน (Required) |
| **Microsoft Teams Webhook URL** | Char | - | URL สำหรับส่งข้อมูลไปยัง Teams (Required) |
| **เปิดการแจ้งเตือน** | Boolean | ✓ False | เปิด/ปิดการแจ้งเตือน |
| **วันที่เริ่มแจ้งเตือน** | Date | วันปัจจุบัน | วันที่เริ่มการแจ้งเตือน |
| **แจ้งเตือนทุก (วัน)** | Integer | 30 | ช่วงเวลา (วัน) ในการแจ้งเตือนซ้ำ |
| **วันสิ้นสุดการแจ้งเตือน** | Date | Auto | คำนวณอัตโนมัติ = วันเริ่ม + ช่วงเวลา |
| **ส่งแจ้งเตือนครั้งสุดท้าย** | Datetime | - | Timestamp ของการส่งครั้งสุดท้าย (ReadOnly) |
| **จำนวนครั้งที่ส่ง** | Integer | 0 | นับจำนวนครั้งที่ส่ง (ReadOnly) |

---

## 📅 Scheduled Action (CRON)

ระบบจะมี CRON Job ที่ทำงานอัตโนมัติ:

```
📱 ส่งแจ้งเตือนการซ่อมไปยัง Microsoft Teams
- ทำงานทุก: 1 วัน
- เวลา: 12:00 AM (กลางคืน)
- สำหรับ: การแจ้งเตือนทั้งหมดที่เปิดใช้งาน
```

**การตรวจสอบ CRON:**
```
Settings → Technical → Scheduled Actions
ค้นหา: "ส่งแจ้งเตือนการซ่อม"
```

---

## 🔍 Server Actions ที่มี

### 1️⃣ 📤 ส่งแจ้งเตือนไปยัง Microsoft Teams
```
ใช้ได้ที่: ประวัติการซ่อม (List/Form)
ทำให้: ส่งแจ้งเตือนทันทีไปยัง Teams
```

### 2️⃣ ✅ เปิดการแจ้งเตือน Microsoft Teams
```
ใช้ได้ที่: ประวัติการซ่อม (List/Form)
ทำให้: สร้างหรือเปิดการแจ้งเตือนใหม่
```

### 3️⃣ ❌ ปิดการแจ้งเตือน Microsoft Teams
```
ใช้ได้ที่: ประวัติการซ่อม (List/Form)
ทำให้: ปิดการแจ้งเตือนที่เลือก
```

---

## 📝 ตัวอย่าง Adaptive Card ที่ส่งไป Teams

```
┌─────────────────────────────────────────────────┐
│  🔧 แจ้งเตือนการซ่อมบำรุงรถ                    │
│  ID: MH-202510-0001 | วันที่: 27/10/2025       │
├─────────────────────────────────────────────────┤
│  🚗 รถ: Suzuki Pickup                           │
│  📋 ทะเบียนรถ: 3123                             │
│  🔧 หมวดหมู่: ⚡ ระบบไฟฟ้า                     │
│  📝 รายการซ่อม: เปลี่ยนแบตเตอรี่                │
│  👨‍🔧 ช่างผู้ซ่อม: นายสมชาย                     │
│  🏢 ผู้ให้บริการ: ศูนย์บริการโตโยต้า             │
│  📅 วันเวลาเริ่มซ่อม: 27/10/2025 08:04:50     │
│  ✅ วันเวลาซ่อมเสร็จ: 27/10/2025 09:00:00     │
│  💰 ค่าใช้จ่าย: ฿ 2,500.00                      │
├─────────────────────────────────────────────────┤
│  📌 หมายเหตุ                                    │
│  แบตเตอรี่เสื่อม เปลี่ยนใหม่ลดราคา 20%        │
├─────────────────────────────────────────────────┤
│  ⏰ กำหนดการแจ้งเตือนถัดไป                      │
│  📅 วันที่: 26/11/2025                          │
├─────────────────────────────────────────────────┤
│  [📌 เปิดรายละเอียด]                             │
└─────────────────────────────────────────────────┘
```

---

## 🛠️ Troubleshooting

### ❌ ข้อผิดพลาด: "Webhook URL is required"
**สาเหตุ**: ไม่ได้ใส่ Webhook URL
**แก้ไข**: ใส่ Webhook URL ที่ได้จาก Microsoft Teams

### ❌ ข้อผิดพลาด: "Connection timeout"
**สาเหตุ**: ไม่สามารถเชื่อมต่อ Microsoft Teams
**แก้ไข**: 
- ตรวจสอบ Webhook URL
- ตรวจสอบการเชื่อมต่อ Internet
- ลอง Setup Webhook ใหม่

### ❌ ไม่มีการส่งแจ้งเตือนอัตโนมัติ
**สาเหตุ**: CRON Job ไม่ทำงาน หรือปิดอยู่
**แก้ไข**: 
- ตรวจสอบ Settings → Technical → Scheduled Actions
- ตรวจสอบว่า CRON Job เปิดอยู่ (Active = ✓)
- ดูประวัติการทำงาน

### ❌ แจ้งเตือนไม่ส่ง แม้เปิดใช้งาน
**สาเหตุ**: 
- วันที่ปัจจุบันอยู่นอกช่วง Start Date - End Date
- ยังไม่ถึงเวลา (ภายใน interval)

**แก้ไข**: ตรวจสอบ:
- วันที่เริ่มแจ้งเตือน <= วันปัจจุบัน <= วันสิ้นสุด
- วันที่ส่งครั้งสุดท้าย + ช่วงเวลา <= วันปัจจุบัน

---

## 📞 Contact & Support

หากมีปัญหาหรือต้องการความช่วยเหลือ ติดต่อทีมพัฒนา
