# ✅ ซ่อนปุ่ม "เพิ่มรายการ" และ "ลบ" ใน Rating

## 🎯 วัตถุประสงค์

1. **ลบปุ่ม "เพิ่มรายการ"** - สร้าง Rating ผ่านฟอร์ม Booking เท่านั้น
2. **ซ่อนปุ่มลบ** (ถังขยะ) - ป้องกันการลบ Rating โดยไม่ตั้งใจ

---

## 📋 การแก้ไข

### 1️⃣ List View

**ไฟล์**: `views/delivery_rating_views.xml`

**เดิม**:
```xml
<list string="การประเมินความพึงพอใจ">
    <!-- ปุ่ม "เพิ่มรายการ" แสดงอยู่ -->
    <!-- ปุ่มถังขยะแสดงอยู่ -->
```

**ใหม่**:
```xml
<list string="การประเมินความพึงพอใจ"
      create="0"
      delete="0">
    <!-- ❌ ไม่มีปุ่ม "เพิ่มรายการ" -->
    <!-- ❌ ไม่มีปุ่มถังขยะ -->
```

**Parameters**:
- `create="0"` → ซ่อนปุ่ม "เพิ่มรายการ" (Create button)
- `delete="0"` → ซ่อนปุ่มถังขยะ (Delete button)

---

### 2️⃣ Form View

**เดิม**:
```xml
<form string="การประเมินความพึงพอใจ">
    <!-- ปุ่มลบแสดงอยู่ใน Action menu -->
```

**ใหม่**:
```xml
<form string="การประเมินความพึงพอใจ" delete="0">
    <!-- ❌ ไม่มีปุ่มลบใน Action menu -->
```

**Parameters**:
- `delete="0"` → ซ่อนปุ่ม "Delete" ใน Action menu

---

## 🎨 การแสดงผลใหม่

### ก่อนแก้ไข:
```
┌─────────────────────────────────────────┐
│ การประเมินความพึงพอใจ    [+ เพิ่มรายการ] │ ← มีปุ่มนี้
├─────────────────────────────────────────┤
│ ☑ BOOK-001  นายA  ลูกค้าB  ...    🗑️   │ ← มีถังขยะ
└─────────────────────────────────────────┘
```

### หลังแก้ไข:
```
┌─────────────────────────────────────────┐
│ การประเมินความพึงพอใจ                   │ ← ไม่มีปุ่ม "เพิ่มรายการ"
├─────────────────────────────────────────┤
│ ☑ BOOK-001  นายA  ลูกค้าB  ...         │ ← ไม่มีถังขยะ
└─────────────────────────────────────────┘
```

---

## 🔒 ผลกระทบ

### ✅ ที่ทำได้:
- ✅ ดู Rating ทั้งหมด
- ✅ เปิด Rating เพื่อดูรายละเอียด
- ✅ คัดลอก Link
- ✅ ดูสถานะ/คะแนน/ความคิดเห็น

### ❌ ที่ทำไม่ได้:
- ❌ สร้าง Rating ใหม่จากหน้า List โดยตรง
- ❌ ลบ Rating (ไม่มีปุ่มถังขยะ)
- ❌ ลบหลายรายการพร้อมกัน (Bulk delete)

### ✅ วิธีสร้าง Rating (ทางเดียว):
```
Booking Form
→ แท็บ "⭐ ประเมินความพึงพอใจ"
→ ปุ่ม "📝 สร้าง Link ประเมินใหม่"
→ บันทึก
```

---

## 🎯 เหตุผล

### 1. ป้องกันการสร้าง Rating ผิดพลาด
- Rating ต้องเชื่อมกับ Booking
- ถ้าสร้างจากหน้า List → อาจลืมเลือก Booking
- บังคับให้สร้างผ่าน Booking Form → ถูกต้องเสมอ

### 2. ป้องกันการลบโดยไม่ตั้งใจ
- Rating เป็นข้อมูลสำคัญ (ประวัติการประเมิน)
- ลูกค้าอาจประเมินไปแล้ว
- ถ้าลบผิด → ข้อมูลหาย / ลูกค้าสับสน

### 3. Data Integrity
- 1 Booking = 1 Rating (Unique constraint)
- ป้องกันการลบแล้วสร้างใหม่ซ้ำ
- รักษาความสมบูรณ์ของข้อมูล

---

## 🔧 กรณีต้องการลบ Rating

### วิธีที่ 1: ผ่าน Developer Mode

```
1. เปิด Developer Mode (Settings → Activate Developer Mode)
2. เปิด Rating Form
3. Action → Delete
4. ยืนยันการลบ
```

### วิธีที่ 2: ผ่าน Database

```sql
-- ⚠️ ใช้เมื่อจำเป็นเท่านั้น!
DELETE FROM delivery_rating WHERE id = <rating_id>;
```

### วิธีที่ 3: เปลี่ยนสถานะเป็น "หมดอายุ"

```
แทนที่จะลบ → เปลี่ยนสถานะเป็น "expired"
1. เปิด Rating Form
2. เปลี่ยน State → "หมดอายุ"
3. บันทึก
```

---

## 🚀 วิธีติดตั้ง

### ขั้นตอนที่ 1: Restart Odoo
```bash
cd C:\Program Files\Odoo 18.0.20251009\server\custom-addons\transport_booking
restart_odoo_hide_create_delete.bat
```

### ขั้นตอนที่ 2: Upgrade Module
```
Settings → Apps → "transport_booking" → Upgrade
```

### ขั้นตอนที่ 3: ทดสอบ

**A. ทดสอบหน้า List**:
```
1. ไปที่ "ประเมินความพึงพอใจ" (ถ้ามีเมนู)
   หรือ
   เปิด Booking → แท็บ Rating → คลิกดู "ประวัติทั้งหมด"
2. ✅ ไม่มีปุ่ม "เพิ่มรายการ"
3. ✅ ไม่มีปุ่มถังขยะ
```

**B. ทดสอบหน้า Form**:
```
1. เปิด Rating Form ใดๆ
2. คลิก Action menu (⋮)
3. ✅ ไม่มีตัวเลือก "Delete"
```

**C. ทดสอบสร้าง Rating**:
```
1. Booking Form
2. แท็บ "⭐ ประเมินความพึงพอใจ"
3. ปุ่ม "📝 สร้าง Link ประเมินใหม่"
4. ✅ ยังสร้างได้ปกติ
```

---

## 📊 เปรียบเทียบ

| ฟีเจอร์ | ก่อนแก้ | หลังแก้ |
|---------|---------|---------|
| **ปุ่ม "เพิ่มรายการ"** | ✅ มี | ❌ ไม่มี |
| **ปุ่มถังขยะ (List)** | ✅ มี | ❌ ไม่มี |
| **ปุ่ม Delete (Form)** | ✅ มี | ❌ ไม่มี |
| **สร้างผ่าน Booking** | ✅ ได้ | ✅ ได้ |
| **ดูข้อมูล** | ✅ ได้ | ✅ ได้ |
| **แก้ไข** | ✅ ได้ | ✅ ได้ |

---

## 🎯 สรุป

### ✅ เปลี่ยนแปลง:
- ❌ ลบปุ่ม "เพิ่มรายการ" (List view)
- ❌ ลบปุ่มถังขยะ (List view)
- ❌ ลบปุ่ม "Delete" (Form view / Action menu)

### ✅ ข้อดี:
- ป้องกันสร้าง Rating ผิดพลาด
- ป้องกันลบโดยไม่ตั้งใจ
- บังคับให้สร้างผ่าน Booking (ถูกต้อง)
- ข้อมูลปลอดภัยขึ้น

### ✅ วิธีสร้าง Rating (เพียงทางเดียว):
```
Booking → แท็บ "⭐ ประเมินความพึงพอใจ" 
       → "📝 สร้าง Link ประเมินใหม่"
```

---

## 🔐 Security Note

แม้จะซ่อนปุ่ม แต่:
- ❌ ผู้ใช้ทั่วไป → ลบไม่ได้
- ✅ Developer Mode + Admin → ยังลบได้ (ถ้าจำเป็น)
- ✅ Database Level → ยังลบได้ (ผ่าน SQL)

ซึ่งถือว่าเหมาะสม เพราะ:
- ผู้ใช้ทั่วไป = ป้องกันความผิดพลาด
- Admin = ยังมีสิทธิ์จัดการเมื่อจำเป็น

---

**เวอร์ชัน**: 18.0.2.6.0  
**วันที่อัปเดต**: 27 ตุลาคม 2568  
**สถานะ**: ✅ แก้ไขเสร็จสมบูรณ์  
**ระดับความปลอดภัย**: 🔒 สูง
